<!--
SPDX-License-Identifier: AGPL-3.0-or-later
Copyright (c) 2025 Robert ƒåmrlec
-->
<div id="akadaQuiz" class="floating-dialog" style="display:none; width:820px; max-width:95vw;"></div>


<style>
    :root{
      --bg:#0f0f14;--panel:#161821;--muted:#8a93a6;--text:#e7ecf7;--accent:#9b7cf6;--accent2:#2dd4bf;--warn:#f59e0b;--danger:#ef4444;--ok:#10b981;
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
      --radius:18px
    }
    html,body{height:100%;}
    body{margin:0;background:linear-gradient(180deg,#0c0c12,#0d1117 30%,#0f141b);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,Helvetica,sans-serif}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    .title{font-size:clamp(20px,3vw,32px);font-weight:800;letter-spacing:.3px}
    .subtitle{color:var(--muted);font-size:14px}
    .card{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.04)}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:2fr 1fr}}
    .story{min-height:180px}
    .choices{display:grid;gap:10px;margin-top:10px}
    button.choice{appearance:none;border:0;border-radius:14px;padding:12px 14px;background:#212636;color:var(--text);text-align:left;cursor:pointer;box-shadow:var(--shadow);transition:.15s transform,.15s background,.15s border,.15s opacity}
    button.choice:hover{transform:translateY(-1px);background:#263044}
    button.choice small{display:block;color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .tag{padding:6px 10px;border-radius:999px;background:#212636;color:#c9d5f2;border:1px solid rgba(255,255,255,.06);font-size:12px}
    .stats{display:grid;gap:10px}
    .stat{background:#121520;border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:10px}
    .stat h4{margin:0 0 6px 0;font-size:12px;letter-spacing:.5px;color:#b8c1d9;text-transform:uppercase}
    .bar{height:10px;background:#0c0f18;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.06)}
    .fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:50%;transition:width .35s ease}
    .fill.warn{background:linear-gradient(90deg,var(--warn),#f87171)}
    .fill.good{background:linear-gradient(90deg,#34d399,#60a5fa)}
    .log{max-height:260px;overflow:auto;scrollbar-width:thin}
    .log p{margin:.5em 0;color:#b9c2d8}
    .muted{color:var(--muted)}
    .foot{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{appearance:none;border:1px solid rgba(255,255,255,.1);background:#1b2030;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn:hover{background:#232a3e}
    .pill{border-radius:999px;padding:6px 10px;background:#1b2030;border:1px solid rgba(255,255,255,.1);font-size:12px}
    .ending{font-size:18px}
    .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;color:#a0a8bd}
    .scoreline{display:flex;align-items:center;gap:6px}
    .badge{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.08);background:#1b2030}
    details.note{margin-top:8px}
    a{color:#a5b4fc}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Vzpon in padec Akada</div>
        <div class="subtitle">Veƒçnivojska interaktivna zgodba iz Mezopotamije (3. tisoƒçletje pr. Kr.)</div>
      </div>
      <div class="foot">
        <span id="era" class="pill">~ 24.‚Äì21. stol. pr. Kr.</span>
        <button class="btn" id="save">Shrani</button>
        <button class="btn" id="load">Nalo≈æi</button>
        <button class="btn" id="reset">Zaƒçni znova</button>
      </div>
    </header>

    <div class="grid" style="margin-top:16px">
      <section class="card story">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div class="tag">Trenutek: <strong id="levelLabel">Prolog</strong></div>
          <div class="muted mono" id="turns"></div>
        </div>
        <h2 id="sceneTitle" style="margin:10px 0 8px 0">Dobrodo≈°el v Akadu</h2>
        <p id="sceneText" class="muted">Pi≈°e se 24. stoletje pr. Kr. Sumerci vladajo mesosopotamskim mestnim dr≈æavicam. V ozadju se dviga Sargon Akadski. Ti bo≈° vodil njegove odloƒçitve.</p>
        <div class="choices" id="choices"></div>
      </section>

      <aside class="card">
        <h3 style="margin:0 0 8px 0">Kazalci oblasti</h3>
        <div class="stats">
          <div class="stat"><h4>Voja≈°ka moƒç</h4><div class="bar"><div class="fill" id="stat-mil"></div></div></div>
          <div class="stat"><h4>Blagajna</h4><div class="bar"><div class="fill" id="stat-tre"></div></div></div>
          <div class="stat"><h4>≈Ωito in preskrba</h4><div class="bar"><div class="fill" id="stat-food"></div></div></div>
          <div class="stat"><h4>Ugled & legitimnost</h4><div class="bar"><div class="fill" id="stat-leg"></div></div></div>
          <div class="stat"><h4>Dru≈æbena stabilnost</h4><div class="bar"><div class="fill" id="stat-stab"></div></div></div>
          <div class="stat"><h4>Zgodovinska toƒçnost</h4><div class="bar"><div class="fill" id="stat-hist"></div></div></div>
          <div class="scoreline"><strong id="histScore">Toƒçnost: 0 / 0</strong><span class="badge" id="histGrade">‚Äì</span></div>
        </div>
        <div class="card" style="margin-top:14px">
          <strong>Kronika</strong>
          <div class="log" id="log"></div>
        </div>
        <details class="note">
          <summary><strong>Kako ocenjujem toƒçnost?</strong></summary>
          <p class="muted">Vsaka izbira dobi toƒçke <em>zgodovinske toƒçnosti</em> (‚àí1, 0, +1) glede na to, kar vemo iz zgodovine Akada: Sargonov voja≈°ki vzpon in trgovina; davki in garnizije; Naram‚ÄëSinova bo≈æanska ikonografija; su≈°a v 22. stol. pr. Kr.; ter zakonnik Ur‚ÄëNamuja v 21. stol. pr. Kr.</p>
        </details>
      </aside>
    </div>

    <section class="card" style="margin-top:16px">
      <details>
        <summary><strong>Navodila</strong></summary>
        <p>Vsaka odloƒçitev spremeni pet kazalcev: <em>Voja≈°ka moƒç</em>, <em>Blagajna</em>, <em>≈Ωito</em>, <em>Ugled</em> in <em>Stabilnost</em>. ƒåe kateri koli pade na 0, se tvoja vladavina konƒça. Zdaj se poleg tega bele≈æi ≈°e <em>zgodovinska toƒçnost</em> tvojih odloƒçitev.</p>
        <p>Igra temelji na resniƒçnih motivih: Sargonov vzpon, trgovina in davki, Naram‚ÄëSinovo bo≈æanstvo, su≈°a v 22. stol. pr. Kr. ter zakonnik Ur‚ÄëNamuja iz Ura (21. stol. pr. Kr.).</p>
      </details>
    </section>

    <footer class="muted" style="text-align:center;margin:20px 0 30px 0">¬© Akad ‚Äî izobra≈æevalna besedilna igra. Nasvet: ciljaj na ravnote≈æje <em>in</em> toƒçne odloƒçitve!</footer>
  </div>

  <script>
  /*** MODEL STANJA ***/
  const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
  const S = {
    mil:60, tre:50, food:50, leg:55, stab:55,
    hist:0, histMax:0,
    level:0, turn:0, over:false
  };

  // h: zgodovinska toƒçnost (‚àí1, 0, +1), why: razlaga
  const LEVELS = [
    {key:"prolog", label:"Sargonov vzpon", title:"Prolog: Sargon Akadski", text:"Iz skromnega polo≈æaja se vzpne≈° v vrhovnega vladarja. Kako utrdi≈° moƒç?", choices:[
      {label:"Osredotoƒçi se na vojsko in disciplinirane enote", hint:"+moƒç, ‚Äìblagajna", d:{mil:+15, tre:-20, leg:+5, stab:+0, food:+0}, h:+1, why:"Sargon je znan po voja≈°kih osvajanjih mestnih dr≈æavic."},
      {label:"Vzpostavi trgovske poti z Babilonom", hint:"+blagajna, +ugled", d:{mil:-10, tre:-10, leg:-10, stab:-10, food:-10}, h:0, why:"Babilon ≈°e ni obstajal."},
      {label:"Skleni dogovore z mestnimi dr≈æavicami", hint:"+stabilnost, +ugled, ‚Äìmoƒç", d:{mil:-8, tre:+3, leg:+10, stab:+12, food:+0}, h:0, why:"Zavezni≈°tva so obstajala, a jedro vzpona je bila sila."},
    ]},

    {key:"uprava", label:"Uprava in davki", title:"Nivo I: Uprava Akada", text:"Imperij raste. Kako ravna≈° s pokorjenimi?", choices:[
      {label:"≈Ωelezna roka: prisilni davek in garnizije", hint:"+blagajna, ‚Äìstabilnost, ‚Äìugled", d:{tre:+10, stab:-12, leg:-10, mil:+5, food:+0}, h:+1, why:"Akad je pobiral davke in name≈°ƒçal garnizije."},
      {label:"Poveƒçaj moƒç sveƒçeni≈°tva", hint:"+stabilnost, +ugled, ‚Äìblagajna", d:{tre:-10, stab:+5, leg:+3, mil:+0, food:+5}, h:0, why:"Moƒç sveƒçenikov se je zmanj≈°ala"},
      {label:"Zemlje je veliko, zato jo daj templjem", hint:"+ugled,  ‚Äìblagajna", d:{food:+5, stab:+5, tre:-10, mil:+0, leg:+3}, h:0, why:"Zemlja ni bila veƒç v lastni≈°tvu templjev."},
    ]},


    {key:"naram", label:"Naram-Sin", title:"Nivo III: Bo≈æanska krona", text:"Tvoj vnuk Naram-Sin dose≈æe vrhunec. Kako zgradi mit?", choices:[
      {label:"Stela z rogatim ≈°lemom in zmagami", hint:"+ugled, ‚Äìstabilnost", d:{leg:+15, stab:-5, tre:-20, mil:+5, food:+0}, h:+1, why:"Naram‚ÄëSin je upodobljen z rogatim ≈°lemom kot bo≈æanski junak."},
      {label:"Reforma vojske (stalne enote)", hint:"+vojska, ‚Äìblagajna", d:{mil:+14, tre:-20, leg:+0, stab:+0, food:+0}, h:0, why:"Reforme so verjetne, a manj neposredno izpriƒçane kot ikonografija."},
    ]},

    {key:"kriza", label:"Su≈°a in lakota", title:"Nivo IV: Leta su≈°e (22. stol. pr. Kr.)", text:"Reke upadejo. Lakota trka na vrata. Kaj stori≈°?", choices:[
      {label:"Odpri ≈æitne rezerve", hint:"+stabilnost, ‚Äì≈æito", d:{food:-14, stab:+12, tre:-5, mil:+0, leg:+4}, h:+1, why:"Odprtje rezerv je tipiƒçen ukrep proti lakoti."},
      {label:"Voja≈°ki pohodi za plen", hint:"+≈æito, +blagajna, ‚Äìugled, ‚Äìstabilnost", d:{food:+10, tre:+10, leg:-12, stab:-10, mil:+4}, h:0, why:"Pohodi so se dogajali, a niso ustavili razpada."},
      {label:"Investiraj v mline na veter, ker vode ni", hint:"+≈æito (poƒçasi), ‚Äìblagajna", d:{food:+0, tre:-30, leg:0, stab:0, mil:0}, h:0, why:"Niso poznali mlinov na veter."},
    ]},


  ];

  const ENDINGS = [
    {id:"divine", test:s=> s.leg>=85 && s.stab>20 && s.mil>=60, title:"Bo≈æanska krona", text:"Naram-Sin te upodobi z rogatim ≈°lemom. Ljudje omahujejo, a spomin na tvojo moƒç je bo≈æanski."},
    {id:"law", test:s=> s.stab>=75 && s.leg>=70, title:"Temelj prava", text:"Uƒçenjaki v Uru sestavijo zbirko zakonov. Imperij je manj≈°i, a red je moƒçnej≈°i od meƒça."},
    {id:"famine", test:s=> s.food<=15, title:"Lakota in razkroj", text:"Skladi≈°ƒça so prazna. Ljudstva se razidejo, vojska se raztepe. Akad podle≈æe su≈°i."},
    {id:"revolt", test:s=> s.stab<=15 || s.leg<=15, title:"Vstaje in propad", text:"Davki in slaba ≈æetev zanetijo upor. Garnizije ne zdr≈æijo ‚Äì vladavina se konƒça v ognju."},
    {id:"bled", test:s=> s.tre<=10, title:"Prazna blagajna", text:"Kovaƒçnice utihnejo, vojaki ostanejo brez plaƒçe. Zmaga tistega, ki hrani svoje ljudi."},
    {id:"iron", test:s=> s.mil>=85 && s.tre>=40 && s.stab>=35, title:"≈Ωelezni sredi≈°ƒçnik", text:"ƒåeprav su≈°a trka, tvoja jedrna oblast zdr≈æi. Dr≈æava se zo≈æa, a ostane zgled reda."},
    {id:"default", test:s=> true, title:"Kolesa zgodovine", text:"Akad opravi svoj krog. Iz pepela vznikne nova doba, v kateri pravila krojijo bogovi in ljudje."}
  ];

  /*** POGON ***/
  const ui={
    mil:document.getElementById('stat-mil'),
    tre:document.getElementById('stat-tre'),
    food:document.getElementById('stat-food'),
    leg:document.getElementById('stat-leg'),
    stab:document.getElementById('stat-stab'),
    hist:document.getElementById('stat-hist'),
    title:document.getElementById('sceneTitle'),
    text:document.getElementById('sceneText'),
    choices:document.getElementById('choices'),
    log:document.getElementById('log'),
    levelLabel:document.getElementById('levelLabel'),
    turns:document.getElementById('turns'),
    era:document.getElementById('era'),
    histScore:document.getElementById('histScore'),
    histGrade:document.getElementById('histGrade')
  };

  function renderBars(){
    const set=(el,val)=>{
      el.style.width=clamp(val,0,100)+"%";
      el.classList.toggle('warn', val<25);
      el.classList.toggle('good', val>70);
    };
    set(ui.mil,S.mil); set(ui.tre,S.tre); set(ui.food,S.food); set(ui.leg,S.leg); set(ui.stab,S.stab);
    // zgodovinska toƒçnost kot odstotek pravilnih odloƒçitev
    const ratio = S.histMax ? Math.round(((S.hist + S.histMax) / (2*S.histMax)) * 100) : 50; // preslikava ‚àí1..+1 v 0..100
    set(ui.hist, ratio);
    ui.histScore.textContent = `Toƒçnost: ${S.histMax? (S.hist>0?'+':'')+S.hist : 0} / ${S.histMax}`;
    ui.histGrade.textContent = gradeFromRatio(ratio);
  }

  function gradeFromRatio(r){
    return r;
  }

  function logMsg(msg){
    const p=document.createElement('p'); p.innerHTML=msg; ui.log.prepend(p);
  }

  function apply(delta, label, histDelta, why){
    for(const k of ['mil','tre','food','leg','stab']){
      S[k]=clamp(S[k]+(delta[k]||0),0,100);
    }
    // zgodovinska toƒçnost
    S.hist += (histDelta||0); S.histMax += 1;

    S.turn++; renderBars(); ui.turns.textContent = `Poteze: ${S.turn}`;
    checkLoss();
    if(label){
      const ico = histDelta>0?'‚úì':(histDelta<0?'‚úó':'‚Ä¢');
      const tone = histDelta>0?'<span style="color:#10b981">‚úì toƒçno</span>':(histDelta<0?'<span style="color:#ef4444">‚úó netoƒçno</span>':'<span class="muted">‚Ä¢ delno / nevtralno</span>');
      logMsg(`${label} ‚Äî ${tone}${why?` <span class="muted">(${why})</span>`:''}`);
    }
  }

  function scene(idx){
    if(idx>=LEVELS.length){ return ending(); }
    S.level=idx;
    const L=LEVELS[idx];
    ui.levelLabel.textContent=L.label;
    ui.title.textContent=L.title;
    ui.text.textContent=L.text;
    ui.choices.innerHTML='';
    L.choices.forEach((c,i)=>{
      const b=document.createElement('button'); b.className='choice';
      b.innerHTML=`<strong>${c.label}</strong><small>${c.hint}</small>`;
      b.addEventListener('click',()=>{
        apply(c.d, `${L.label}: ${c.label}`, c.h||0, c.why);
        scene(idx+1);
      });
      ui.choices.appendChild(b);
    });
    const eras=["~ 24. stol. pr. Kr.","~ 24.‚Äì23. stol.","~ 23. stol.","~ 23.‚Äì22. stol.","~ 22. stol.","~ 21. stol. pr. Kr."];
    ui.era.textContent = eras[clamp(idx,0,eras.length-1)];
  }

  function checkLoss(){
    if(S.mil<=0||S.tre<=0||S.food<=0||S.leg<=0||S.stab<=0){
      S.over=true; gameOver("Propad: eden od kazalcev je padel na niƒç.");
    }
  }

  function ending(){
    const e = ENDINGS.find(e=>e.test(S));
    const ratio = S.histMax ? Math.round(((S.hist + S.histMax) / (2*S.histMax)) * 100) : 50;
    const block=document.createElement('div');
    block.className='ending';
    block.innerHTML=`<h2>KONEC ‚Äì ${e.title}</h2><p>${e.text}</p>
    <p class="muted">Povzetek: Vojska ${S.mil} ¬∑ Blagajna ${S.tre} ¬∑ ≈Ωito ${S.food} ¬∑ Ugled ${S.leg} ¬∑ Stabilnost ${S.stab}</p>
    <p><strong>Zgodovinska toƒçnost:</strong> ${S.hist>0?'+':''}${S.hist} / ${S.histMax} (${ratio}%, ocena ${gradeFromRatio(ratio)})</p>
    <div class="row" style="margin-top:10px">
      <button class="btn" onclick="restart()">Igraj znova</button>
      <button class="btn" onclick="shareState()">Deli izid</button>
    </div>`;
    ui.choices.innerHTML='';
    ui.text.innerHTML='';
    ui.title.textContent='Epilog Akada';
    ui.choices.appendChild(block);
    logMsg(`Zakljuƒçek: ${e.title}`);
  }

  function gameOver(reason){
    ui.choices.innerHTML='';
    const ratio = S.histMax ? Math.round(((S.hist + S.histMax) / (2*S.histMax)) * 100) : 50;
    const b=document.createElement('div');
    b.className='ending';
    b.innerHTML=`<h2>${reason}</h2><p>Tvoja vladavina se tu konƒça. Poskusi drugaƒçno ravnote≈æje med davki, ≈æitom in ugledom.</p>
    <p><strong>Zgodovinska toƒçnost do zdaj:</strong> ${S.hist>0?'+':''}${S.hist} / ${S.histMax} (${ratio}%, ocena ${gradeFromRatio(ratio)})</p>
    <div class="row" style="margin-top:10px"><button class="btn" onclick="restart()">Poskusi znova</button></div>`;
    ui.choices.appendChild(b);
  }

  function restart(){
    Object.assign(S,{mil:60,tre:50,food:50,leg:55,stab:55,hist:0,histMax:0,level:0,turn:0,over:false});
    ui.log.innerHTML='';
    renderBars();
    scene(0);
  }

  function save(){
    localStorage.setItem('akad-save', JSON.stringify(S));
    logMsg('‚úî Shranjeno.');
  }
  function load(){
    const raw=localStorage.getItem('akad-save');
    if(!raw){ logMsg('Ni shrambe za nalo≈æiti.'); return; }
    const obj=JSON.parse(raw); Object.assign(S,obj);
    renderBars();
    ui.turns.textContent = `Poteze: ${S.turn}`;
    scene(S.level);
    logMsg('‚éò Nalo≈æeno.');
  }
  function shareState(){
    const data=btoa(JSON.stringify(S));
    const url=new URL(location.href); url.hash=data;
    navigator.clipboard.writeText(url.toString()).then(()=>logMsg('üîó Povezava do izida kopirana v odlo≈æi≈°ƒçe.'));
  }
  function tryHashLoad(){
    if(location.hash.length>1){
      try{ const obj=JSON.parse(atob(location.hash.slice(1))); Object.assign(S,obj); }catch(e){}
    }
  }

  document.getElementById('save').onclick=save;
  document.getElementById('load').onclick=load;
  document.getElementById('reset').onclick=restart;

  tryHashLoad();
  renderBars();
  scene(S.level||0);
  </script>
